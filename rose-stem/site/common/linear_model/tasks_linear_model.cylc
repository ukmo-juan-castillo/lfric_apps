{# ########################################################################### #}
{# (c) Crown copyright 2024 Met Office. All rights reserved. #}
{# The file LICENCE, distributed with this code, contains details of the terms #}
{# under which the code may be used. #}
{# ########################################################################### #}
{% do LOG.debug("Entered site/common/linear_model/tasks_linear_model.cylc") %}

{% if task_ns.conf_name == "nwp_gal9-C12_MG" %}

    {% do task_dict.update({
        "opt_confs": ["nwp_gal9_c12"],
        "resolution": "C12_MG",
        "DT": 1800,
        "tsteps": 12,
        "mpi_parts": 6,
        "plot_str": "linear.py $NODAL_DATA_DIR/lfric_diag.nc $PLOT_DIR 70 linear_model-nwp-gal9_C12 theta:exner:rho:u_in_w3:v_in_w3:m_v:m_cl:m_r:m_cf 120:0:5",
    }) %}

{% elif task_ns.conf_name == "nwp_gal9-C224_MG" %}

    {% do task_dict.update({
        "opt_confs": ["nwp_gal9_c224"],
        "resolution": "C224_MG",
        "DT": 1800,
        "tsteps": 12,
        "mpi_parts": 1176,
        "xios_nodes": 4,
        "mpi_parts_xios" : 16,
        "log_level": "debug",
        "plot_str": "linear.py $NODAL_DATA_DIR/lfric_diag.nc $PLOT_DIR 70 linear_model-nwp-gal9_C224 theta:exner:rho:u_in_w3 120:0:5",
        "tech-tests_wallclock": 30,
    }) %}

{% elif task_ns.conf_name == "nwp_gal9_random-C12_MG" %}

    {% do task_dict.update({
        "opt_confs": ["nwp_gal9_c12","random"],
        "resolution": "C12_MG",
        "DT": 1800,
        "tsteps": 12,
        "mpi_parts": 6,
        "plot_str": "linear.py $NODAL_DATA_DIR/lfric_diag.nc $PLOT_DIR 70 linear_model-nwp-gal9_random theta:exner:rho:u_in_w3:v_in_w3:m_v:m_cl:m_r:m_cf 120:0:5",
    }) %}

{% elif task_ns.conf_name == "nwp_gal9_zero-C12_MG" %}

    {% do task_dict.update({
        "opt_confs": ["nwp_gal9_c12","zero"],
        "resolution": "C12_MG",
        "DT": 1800,
        "tsteps": 12,
        "mpi_parts": 6,
        "plot_str": "linear.py $NODAL_DATA_DIR/lfric_diag.nc $PLOT_DIR 70 linear_model-nwp-gal9_random theta:exner:rho:m_v:m_cl:m_r:m_cf 120:0:5",
    }) %}

{% elif task_ns.conf_name == "runge-kutta-C12" %}

    {% do task_dict.update({
        "opt_confs": ["runge-kutta"],
        "resolution": "C12",
        "DT": 1,
        "tsteps": 20,
        "plot_str": "linear.py $NODAL_DATA_DIR/lfric_diag.nc $PLOT_DIR 5 linear_model-runge-kutta rho 120:0:3"
    }) %}

{% elif task_ns.conf_name == "semi-implicit-C12" %}

    {% do task_dict.update({
        "opt_confs": ["semi-implicit"],
        "resolution": "C12",
        "DT": 10,
        "tsteps": 100,
        "mpi_parts": 6,
        "plot_str": "linear.py $NODAL_DATA_DIR/lfric_diag.nc $PLOT_DIR 5 linear_model-semi-implicit rho 120:0:3"
    }) %}

{% elif task_ns.conf_name == "dcmip301-C24" %}

    {% do task_dict.update({
        "opt_confs": ["dcmip301"],
        "resolution": "C24",
        "DT": 10,
        "tsteps": 180,
        "mpi_parts": 12,
        "plot_str": "linear.py $NODAL_DATA_DIR/lfric_diag.nc $PLOT_DIR 10 linear_model-dcmip theta:exner:rho:u_in_w3:v_in_w3 120:0:5"
    }) %}

{% elif task_ns.conf_name == "canned" %}

    {% do task_dict.update({
        "app_name": "canned_test",
        "kgo_checks": [],
    }) %}

{% elif task.startswith("build") %}

    {% do task_dict.update({
        "placeholder": true,
    }) %}

{% endif %}


{# Set default values for Linear Model tasks #}
{% if task_dict %}
    {% do task_dict.update({"application_dir": "lfric_apps/applications/linear_model"}) %}
    {% if "app_name" not in task_dict %}
        {% do task_dict.update({"app_name": "linear_model"}) %}
    {% endif %}
    {% if "kgo_checks" not in task_dict %}
        {% do task_dict.update({"kgo_checks": "checksum"}) %}
    {% endif %}
{% endif %}

{% do LOG.debug("Finished in site/common/linear_model/tasks_linear_model.cylc") %}
